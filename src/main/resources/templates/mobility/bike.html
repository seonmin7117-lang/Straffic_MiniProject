<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<body>
<div layout:fragment="content">
    <style>
        /* ktx.htmlê³¼ ë™ì¼í•œ ê°„ê²© ì ìš© */
        .layout-content {
            padding: 80px 0 40px;
            min-height: 200vh;
            display: flex;
            flex-direction: column;
        }

        .bike-container {
            width: 1150px;
            max-width: 100%;
            margin: 0 auto;
            background: #fff;
            padding: 40px;
            border-radius: 12px;
            border: 1px solid #ddd;
            box-sizing: border-box;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .ktx-title {
            font-size: 1.6rem;
            font-weight: 700;
            margin: 0 0 16px 0;
            color: #333;
        }

        .ktx-subtitle {
            margin: 0 0 24px 0;
            color: #555;
            font-size: 0.95rem;
        }

        .content-wrapper {
            display: flex;
            gap: 24px;
            margin-top: 20px;
        }

        .left-panel {
            width: 320px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .filter-section, .search-card {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
        }

        .section-header {
            font-weight: 700;
            margin-bottom: 16px;
            font-size: 1rem;
            color: #333;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }

        .filter-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            border: 1px solid transparent;
            margin-bottom: 8px;
        }

        .filter-option:hover {
            background: #f9f9f9;
        }

        .filter-option.active {
            background: #f0f7ff;
            border-color: #cce5ff;
            color: #0066ff;
            font-weight: 600;
        }

        .right-panel {
            flex: 1;
        }

        #map {
            width: 100%;
            height: 750px;
            border-radius: 12px;
            border: 1px solid #ddd;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .search-button {
            width: 100%;
            background: #333;
            color: #fff;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 0.95rem;
        }

        .search-button:hover {
            background: #000;
        }

        .custom-infowindow {
            padding: 15px;
            min-width: 200px;
        }
        
        .info-status {
            display: inline-block;
            padding: 4px 10px;
            background: #28a745;
            color: #fff;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .info-status.low { background: #ffc107; color: #333; }
        .info-status.none { background: #dc3545; }

        @media (max-width: 1024px) {
            .bike-container { width: auto; max-width: 100%; padding: 30px; }
            .content-wrapper { flex-direction: column; }
            .left-panel { width: 100%; display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
            #map { height: 600px; }
        }

        @media (max-width: 768px) {
            .bike-container { padding: 20px 16px; }
            
            .content-wrapper { 
                flex-direction: column-reverse; /* ëª¨ë°”ì¼ì—ì„œëŠ” ì§€ë„ê°€ ë¨¼ì € ë‚˜ì˜¤ë„ë¡ ìˆœì„œ ë°˜ì „ */
                gap: 16px;
            }
            
            .left-panel { 
                display: flex; 
                flex-direction: column; 
                gap: 12px;
            }
            
            #map { 
                height: 50vh; 
                min-height: 400px; 
            }

            .filter-section, .search-card {
                padding: 16px;
            }

            .ktx-title { font-size: 1.35rem; margin-bottom: 8px; }
            .ktx-subtitle { font-size: 0.9rem; margin-bottom: 16px; }
            
            .section-header { margin-bottom: 12px; font-size: 0.95rem; }
            .filter-option { padding: 10px; font-size: 0.9rem; }
        }
    </style>

    <div class="bike-container">
        <h1 class="ktx-title">ğŸš´ ê³µìœ  ëª¨ë¹Œë¦¬í‹°</h1>
        <p class="ktx-subtitle">ë”°ë¦‰ì´ì™€ ê³µìœ  í‚¥ë³´ë“œë¥¼ ì§€ë„ì—ì„œ í™•ì¸í•˜ê³  ê°€ê¹Œìš´ ìœ„ì¹˜ë¥¼ ì°¾ì•„ë³´ì„¸ìš”</p>

        <div class="content-wrapper">
            <div class="left-panel">
                <div class="filter-section">
                    <div class="section-header">ğŸ” ëª¨ë¹Œë¦¬í‹° íƒ€ì…</div>
                    <div class="filter-option active" onclick="toggleFilter('bike', this)">
                        <input type="checkbox" id="filter-bike" checked>
                        <label for="filter-bike" style="cursor:pointer">ğŸš´ ë”°ë¦‰ì´</label>
                    </div>
                    <div class="filter-option active" onclick="toggleFilter('kickboard', this)">
                        <input type="checkbox" id="filter-kickboard" checked>
                        <label for="filter-kickboard" style="cursor:pointer">ğŸ›´ ê³µìœ  í‚¥ë³´ë“œ</label>
                    </div>
                </div>

                <div class="search-card">
                    <div class="section-header">ğŸ“ ë‚´ ìœ„ì¹˜ ê²€ìƒ‰</div>
                    <p style="margin:0 0 16px 0; color:#666; font-size:0.9rem;">í˜„ì¬ ìœ„ì¹˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì£¼ë³€ ê¸°ê¸°ë¥¼ ì°¾ìŠµë‹ˆë‹¤.</p>
                    <button class="search-button" onclick="searchNearby()">ë‚´ ìœ„ì¹˜ì—ì„œ ì°¾ê¸°</button>
                </div>
            </div>

            <div class="right-panel">
                <div id="map"></div>
            </div>
        </div>
    </div>

    <script th:src="'//dapi.kakao.com/v2/maps/sdk.js?appkey=' + ${kakaoKey} + '&autoload=false'"></script>
    <script>
        var map;
        var markers = { bike: [], kickboard: [] };
        window.addEventListener('load', function() {
            kakao.maps.load(function() {
                var container = document.getElementById('map');
                var options = { center: new kakao.maps.LatLng(37.4895, 126.7234), level: 5 };
                map = new kakao.maps.Map(container, options);
                var bikeStations = [
                    {name:'ë¶€í‰ì—­ 1ë²ˆ ì¶œêµ¬', lat:37.4895, lng:126.7234, available:12, type:'bike'},
                    {name:'ë¶€í‰ì—­ 3ë²ˆ ì¶œêµ¬', lat:37.4900, lng:126.7240, available:8, type:'bike'},
                    {name:'ë¶€í‰ì‹œì¥ì—­', lat:37.4920, lng:126.7210, available:3, type:'bike'}
                ];
                var kickboardLocations = [
                    {name:'í‚¥ë³´ë“œ #KK-001', lat:37.4890, lng:126.7230, battery:100, available:true, type:'kickboard'},
                    {name:'í‚¥ë³´ë“œ #KK-002', lat:37.4897, lng:126.7237, battery:95, available:true, type:'kickboard'},
                    {name:'í‚¥ë³´ë“œ #KK-003', lat:37.4903, lng:126.7225, battery:90, available:true, type:'kickboard'},
                    {name:'í‚¥ë³´ë“œ #KK-004', lat:37.4910, lng:126.7245, battery:85, available:false, type:'kickboard'}
                ];
                bikeStations.forEach(function(station) { createMarker(station, 'bike'); });
                kickboardLocations.forEach(function(location) { createMarker(location, 'kickboard'); });
            });
        });
        function createMarker(data, type) {
            var position = new kakao.maps.LatLng(data.lat, data.lng);
            var imageSrc = type === 'bike' ? 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png' : 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png';
            var imageSize = new kakao.maps.Size(24, 35);
            var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);
            var marker = new kakao.maps.Marker({ position: position, image: markerImage, title: data.name });
            marker.setMap(map);
            markers[type].push(marker);
            var content = '<div class="custom-infowindow">';
            if (type === 'bike') {
                var statusClass = data.available > 5 ? '' : (data.available > 0 ? 'low' : 'none');
                content += '<div style="font-weight:700; margin-bottom:8px;">' + data.name + '</div>';
                content += '<div>ğŸš´ ëŒ€ì—¬ ê°€ëŠ¥: <span class="info-status ' + statusClass + '">' + data.available + 'ëŒ€</span></div>';
            } else {
                var statusClass = data.available ? '' : 'none';
                var statusText = data.available ? 'ì´ìš© ê°€ëŠ¥' : 'ì´ìš© ì¤‘';
                content += '<div style="font-weight:700; margin-bottom:8px;">' + data.name + '</div>';
                content += '<div>ğŸ”‹ ë°°í„°ë¦¬: <strong>' + data.battery + '%</strong></div>';
                content += '<div>ìƒíƒœ: <span class="info-status ' + statusClass + '">' + statusText + '</span></div>';
            }
            content += '</div>';
            var infowindow = new kakao.maps.InfoWindow({ content: content, removable: true });
            kakao.maps.event.addListener(marker, 'click', function() { infowindow.open(map, marker); });
        }
        function toggleFilter(type, element) {
            var checkbox = element.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            if (checkbox.checked) {
                element.classList.add('active');
                markers[type].forEach(function(m) { m.setMap(map); });
            } else {
                element.classList.remove('active');
                markers[type].forEach(function(m) { m.setMap(null); });
            }
        }
        function searchNearby() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(pos) {
                    var moveLatLon = new kakao.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
                    map.setCenter(moveLatLon); map.setLevel(4);
                    alert('í˜„ì¬ ìœ„ì¹˜ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤');
                }, function() { alert('ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'); });
            } else { alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤'); }
        }
    </script>
</div>
</body>
</html>
